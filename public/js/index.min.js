var userReg=document.getElementById("user-reg"),userRegTip=document.getElementById("user-reg-tip"),chatMsgSend=document.getElementsByClassName("chat-msg-send")[0],infoTab=document.getElementsByClassName("info-tab")[0],chatMsgList=document.getElementsByClassName("chat-msg-list")[0],userList=document.getElementsByClassName("user-lists")[0],roomList=document.getElementsByClassName("room-list")[0],chatMoreBox=document.getElementsByClassName("chat-more-box")[0];document.body.onload=function(){chatMsgSend.focus()};var socketHostName=document.location.hostname,socketURI="http://"+socketHostName+":8089/",socket=io(socketURI),nodejsChat={};nodejsChat.data={isRoomInit:!1,messIsFirst:!0,messIsFoucs:!1,isInitInsertEmoji:!1,onlineUserCount:0,onlineUserList:[],welcomeInfo:"ç³»ç»Ÿ: æ¬¢è¿æ¥åˆ° ",roomID:null,user:{name:null,pass:null,desc:null,img:null}},nodejsChat.room={init:function(){socket.on("request room id",function(){socket.emit("response room id",nodejsChat.data.roomID),nodejsChat.method.insertToList(chatMsgList,"li",nodejsChat.data.welcomeInfo+nodejsChat.data.roomID),chatMsgSend.value="",chatMoreBox.style.visibility="hidden",chatMsgSend.onclick=function(){chatMoreBox.style.visibility="hidden",nodejsChat.data.messIsFoucs=!0}}),socket.on("showRoom",function(e){nodejsChat.method.insertToList(roomList,"li",e)}),socket.on("welcome the user",function(e){nodejsChat.method.insertToList(chatMsgList,"li",e)}),socket.on("request user logout",function(e){console.log(e),nodejsChat.method.insertToList(chatMsgList,"li",e.currentUser+" ç¦»å¼€äº†æˆ¿é—´"),nodejsChat.method.toBottom(),nodejsChat.method.initList(userList),nodejsChat.method.renderList("user",e.currentUserList)})},render:function(){socket.on("current status",function(e){nodejsChat.method.initList(userList),nodejsChat.method.getOnlineList(e.room,nodejsChat.data.roomID),nodejsChat.method.renderList("user",nodejsChat.data.onlineUserList),nodejsChat.method.renderList("room",e.roomList),console.log(e),console.log("åœ¨çº¿ç»Ÿè®¡ï¼š"+nodejsChat.data.onlineUserCount),console.log("åœ¨çº¿ç”¨æˆ·ï¼š"+nodejsChat.data.onlineUserList)}),socket.on("renderOnlineList",function(e){nodejsChat.method.insertToList(userList,"li",e)}),socket.on("latestTalk",function(e){nodejsChat.method.insertToList(chatMsgList,"li",e.user+": "+e.msg),console.log(e),nodejsChat.method.toBottom()}),socket.on("showUser",function(e){e.status?(userRegTip.innerHTML="æ³¨å†ŒæˆåŠŸ",nodejsChat.method.renderList("user",[e.user])):(userRegTip.innerHTML="ç”¨æˆ·åå·²å­˜åœ¨",nodejsChat.data.user.name=null),console.log(e),console.log("å½“å‰åœ¨çº¿ï¼š"+e.user.length),console.log("æ³¨å†ŒçŠ¶æ€ï¼š"+e.status)})}},nodejsChat.method={getRoomID:function(){var e=document.location.pathname,t="/"===e,o=null;return t||-1===e.indexOf("room")||(o=e.replace(/\/.*?\//,"")),null===o?o="Chat Room":decodeURIComponent(o)},initList:function(e){e.innerHTML=""},renderList:function(e,t,o){for(var s={room:roomList,user:userList,chat:chatMsgList,emoji:chatMoreBox},n=0;n<t.length;n++)this.insertToList(s[e],"li",t[n])},insertToList:function(e,t,o){var s=document.createElement(t);s.innerHTML=o,e.appendChild(s)},parseMsgVal:function(e){return val=e.replace(/</g,"&lt;"),val=val.replace(/>/g,"&gt;"),val},sendMessage:function(){""!==chatMsgSend.value?(chatMoreBox.style.visibility="hidden",socket.emit("send message",nodejsChat.data.roomID,{user:null!==nodejsChat.data.user.name?nodejsChat.data.user.name:"ç¥ç§˜äºº",msg:this.parseMsgVal(chatMsgSend.value)}),nodejsChat.method.insertToList(chatMsgList,"li",(null!==nodejsChat.data.user.name?nodejsChat.data.user.name:"ç¥ç§˜äºº")+": "+this.parseMsgVal(chatMsgSend.value)),chatMsgSend.value="",chatMsgSend.focus(),nodejsChat.method.toBottom()):userRegTip.innerHTML="å†…å®¹ä¸èƒ½ä¸ºç©º"},regUser:function(){nodejsChat.data.user.name?userRegTip.innerHTML="å·²ç™»é™†ï¼Œç”¨æˆ·åä¸ºï¼š"+nodejsChat.data.user.name:""!==userReg.value&&" "!==userReg.value?(nodejsChat.data.user.name=this.parseMsgVal(userReg.value),socket.emit("add user",nodejsChat.data.roomID,{name:this.parseMsgVal(userReg.value)})):userRegTip.innerHTML="è¯·è¾“å…¥ç”¨æˆ·å"},getOnlineList:function(e,t){e.filter(function(e){if(e.name===t){var o=e.user.concat();nodejsChat.data.onlineUserCount=e.user.length,nodejsChat.data.onlineUserList=o}})},getRandomImg:function(e){return"https://randomuser.me/api/portraits/"+e+"/"+parseInt(100*Math.random())+".jpg"},getRandomNick:function(e,t){return"https://uinames.com/api/?region="+e+"&gender="+t+"&amount=1"},setInfoTabMargin:function(e){infoTab.style.marginLeft=181*-(e-1)+"px"},getEmoji:function(e){var t=["ğŸ˜…","ğŸ˜‚","ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜˜","ğŸ˜—","ğŸ˜œ","ğŸ˜","ğŸ˜","ğŸ˜”","ğŸ™","ğŸ˜¶","ğŸ˜¢","ğŸ¤”","ğŸ‘","ğŸ¤","ğŸ‘","ğŸ‘","âœŒ","â¤","ğŸ¶","ğŸ±","ğŸ°","ğŸ­","ğŸ·","ğŸ¸","ğŸ™ˆ"],o=e||chatMoreBox;this.initList(o),"hidden"===o.style.visibility?chatMoreBox.style.visibility="visible":chatMoreBox.style.visibility="hidden",this.renderList("emoji",t),!1===nodejsChat.data.isInitInsertEmoji&&this.initInsertEmoji()},initInsertEmoji:function(){chatMoreBox.addEventListener("click",function(e){"li"===e.target.tagName.toLowerCase()&&nodejsChat.method.insertEmoji(e.target.innerText)},!1),nodejsChat.data.isInitInsertEmoji=!0},insertEmoji:function(e){var t=chatMsgSend.value,o=chatMsgSend.selectionStart;nodejsChat.data.messIsFirst&&!nodejsChat.data.messIsFoucs&&(o=t.length),nodejsChat.data.messIsFirst=!1,""===t?chatMsgSend.value=e:t.length===o?chatMsgSend.value=chatMsgSend.value+e:chatMsgSend.value=t.slice(0,o)+e+t.slice(o,t.length),chatMsgSend.focus(),console.log("currentFoucsIndex: "+o),console.log(t.length)},toBottom:function(){var e=document.getElementsByClassName("chat-ctx")[0];e.scrollTop=e.scrollHeight}},document.body.onload=function(){nodejsChat.data.roomID=nodejsChat.method.getRoomID(),nodejsChat.room.init(),nodejsChat.room.render(),console.log(nodejsChat.method.getRandomImg("men")),console.log(nodejsChat.method.getRandomNick("china","male"))};